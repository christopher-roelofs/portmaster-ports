<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PortMaster Wiki</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
        }

        #cards-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding-top: 70px;
            /* Add padding between the search bar and the row of cards */
        }

        .card {
            width: 325px;
            padding: 10px;
            margin: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .card-img {
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            width: 100%;
            max-width: 300px;

        }

        h3 {
            margin-top: 0;
        }

        p {
            margin-bottom: 0;
        }

        #clear-button {
            position: fixed;
            top: 2px;
            /* Position above the columns */
            right: 150px;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            background-color: #ccc;
            cursor: pointer;
        }

        #search-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
            /* Add a white background to the search bar */
        }

        #filter-bar {
            position: fixed;
            /* Position above the columns */
            right: 15px;
            
        }

            
        @media screen and (min-width: 768px) {


        }
    </style>
</head>

<body>
    <div id="search-bar-container">
        <input type="text" id="search-bar" placeholder="Search by name or genre" oninput="filterCards()">
        <button id="clear-button" onclick="clearSearch()">Clear</button>
    </div>
    <div id="filter-bar">
        <label for="filter-toggle">Ready to Run:</label>
        <input type="checkbox" id="filter-toggle" onchange="filterCards()">
    </div>

    <div id="cards-container"></div>

    <script>
        var jsonData = null;
        // Function to create a card element for each JSON object
        function createCard(data) {
            const cardElement = document.createElement('div');
            cardElement.className = 'card';

            const titleElement = document.createElement('h3');
            titleElement.textContent = data.attr.title;

            titleElement.addEventListener('click', () => {
                const title = titleElement.textContent;
                handleCardClick(title);
            });

            const imageElement = document.createElement("img");
            imageElement.src = "https://raw.githubusercontent.com/christianhaitian/PortMaster/main/" + data.attr.image.screenshot;
            imageElement.className = "card-img"

            imageElement.addEventListener('click', () => {
                const title = titleElement.textContent;
                handleCardClick(title);
            });

            const contentElement = document.createElement('p');
            contentElement.textContent = "Description: " + data.attr.desc;

            const instructionElement = document.createElement('p');
            instructionElement.textContent = "Instructions: " + (data.instructions ?? '');


            const genreElement = document.createElement('p');
            genreElement.textContent = "Genres: " + data.attr.genres.join();



            cardElement.appendChild(titleElement);
            cardElement.appendChild(imageElement);
            cardElement.appendChild(contentElement);
            cardElement.appendChild(instructionElement);
            cardElement.appendChild(genreElement);


            return cardElement;
        }

        // Function to iterate over the JSON data and display cards
        function displayCards(data) {
            const cardsContainer = document.getElementById('cards-container');
            cardsContainer.innerHTML = ''; // Clear previous cards
            for (var key of Object.keys(data)) {
                const card = createCard(data[key]);
                cardsContainer.appendChild(card);
            };
        }

        // Function to filter the cards based on the search query
        function filterCards() {
            const searchQuery = document.getElementById('search-bar').value.trim().toLowerCase();
            const readyToRun = document.getElementById('filter-toggle').checked;
            var filteredData = {}
            var queries = searchQuery.split(" ");
            for (var key of Object.keys(jsonData)) {
                queries.forEach(element => {
                    if (jsonData[key].attr.title.toLowerCase().includes(element) || jsonData[key].attr.genres.join().toLowerCase().includes(element)) {

                        if (readyToRun){
                            if (jsonData[key].attr.rtr){
                                filteredData[key] = jsonData[key];
                            }
                        }
                        else {
                            filteredData[key] = jsonData[key];
                        }
                        
                        
                    }
                });

            };
            displayCards(filteredData);
        }

        // Function to handle the card title click and redirect to the detail page
        function handleCardClick(title) {
            window.location.href = `detail.html?title=${encodeURIComponent(title)}`;
        }

        // Function to clear the search bar and show all cards
        function clearSearch() {
            document.getElementById('search-bar').value = ''; // Clear the search input
            filterCards(); // Show all cards again
        }

        // Fetch JSON data from the URL and then display the cards
        async function fetchDataAndDisplayCards() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/kloptops/pugwash/main/pugwash/data/ports.json'); // Replace 'YOUR_JSON_URL_HERE' with the actual URL of your JSON data.
                if (!response.ok) {
                    throw new Error('Network response was not ok.');
                }
                jsonData = await response.json();
                jsonData = jsonData.ports
                displayCards(jsonData);
            } catch (error) {
                console.error('Error fetching JSON data:', error);
            }
        }

        // Call the initial fetchDataAndDisplayCards function when the page is loaded
        window.onload = function () {
            fetchDataAndDisplayCards();
            document.getElementById('search-bar').addEventListener('input', filterCards);
        };
    </script>
</body>

</html>